name: Semgrep Scan (Static Code Analysis)

on:
  push:
    branches:
      - main
      - master

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  semgrep:
    runs-on: self-hosted

    steps:
      # 1. Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2. Setup Python
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      # 3. Install Semgrep
      - name: Install Semgrep
        run: pip3 install --user semgrep

      # 4. Add local Python bin to PATH
      - name: Add local Python bin to PATH
        run: echo "$HOME/.local/bin" >> $GITHUB_PATH

      # 5. Run default Semgrep scan
      - name: Run Semgrep scan
        run: semgrep --config auto ./FNR
